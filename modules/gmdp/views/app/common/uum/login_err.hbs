<script></script>
<div class="row">
    <div class="col-xs-12 col-md-12">
        <div class="widget">
            <div class="widget-body">
                <div id="cc" class="easyui-layout" data-options="fit:true,border:false" style="width: 800px; height:580px;background-color: #fbfbfb;">
                    <div data-options="region:'center',border:false" style="overflow-x:hidden;overflow-y:hidden">
                        <div id="toolbar" class="row tbRow" style="">
                            <div class="col-xs-6 col-md-6">
                                <div class="btn-group" role="group" aria-label="...">
                                    <button type="button" class="btn btn-default" onclick="doDelete()" data-title="删除">
                                        <i class="fa fa-remove"></i> 删除
                                    </button>
                                </div>
                            </div>
                            <div class="col-xs-6 col-md-6 text-right">
                                <form id="searchFrom" class="form-inline">
                                    <div class="form-group">
                                        <div class="input-group">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="btn-group" role="group" aria-label="...">
                                            <label for="filterParam3">时间：</label>
                                            <input id="queryDate" class="easyui-datebox" label="Start Date:" labelPosition="top" style="width:130px;height:35px">
                                        </div>
                                        <div class="input-group">
                                            <input type="input" class="form-control" id="user_no" name="user_no" placeholder="用户编号">
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" onclick="doSearch()"><i class="fa fa-search"></i>查询</button>
                                            </span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <table id="userdatatable">

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script>

    /**
     * @author ZhaoJing
     * 扩展javaScriptDate类型工具js
     * 实现格式化日期功能
     */
    Date.prototype.format = function(format){
        if(isNaN(this.getMonth())){
            return '';
        }
        if(!format){
            format = 'yyyy-MM-dd';
        }
        var o = {
            //month
            "M+" : this.getMonth() + 1,
            //day
            "d+" : this.getDate(),
            //hour
            "h+" : this.getHours(),
            //minute
            "m+" : this.getMinutes(),
            //second
            "s+" : this.getSeconds(),
            //quarter
            "q+" : Math.floor((this.getMonth() + 3) / 3),
            //millisecond
            "s" : this.getMilliseconds()
        };
        if(/(y+)/.test(format)){
            format = format.replace(RegExp.$1,(this.getFullYear() + "").substr(4 - RegExp.$1.length));
        }
        for(var k in o){
            if(new RegExp("(" + k + ")").test(format)){
                format = format.replace(RegExp.$1,RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
            }
        }
        return format;
    };
    $(document).ready(function() {
        $('#userdatatable').datagrid({
            url:'{{projcfg.appurl}}/admin/api/common/uum/login_err',
            method:'get',
            rownumbers:true,
            //autoRowHeight:true,
            striped:true,
            fitColumns:false,
            toolbar: '#toolbar',
            fit:true,
            border:true,
            singleSelect:false,
            selectOnCheck:false,
            //checkOnSelect:true,
            columns:[[
                {field:'_id',checkbox:true},
                {"field": "login_account","title":"登陆账号","width":'10%'},
                {"field": "user_name","title":"用户姓名","width":'10%'},
                {"field": "user_no","title":"用户编号","width":'15%'},
                {"field": "user_phone","title":"手机号码","width":'20%'},
                {"field": "login_time","title":"登录时间","width":'40%',
                    formatter : function(value, rowData, rowIndex) {
                        return new Date(value).format();
                    }
                }
            ]],
            onDblClickRow:function(rowIndex, rowData){
                //doEdit(1,rowIndex,rowData);
            },
            onLoadSuccess:function(json) {
                if(!json.success) {
                    msgError(json.msg + ',错误代码:' + json.code);
                }
            },
            onLoadError:function() {
                msgError('加载数据出现时发生错误,请稍候重试...');
            },
            pagination:true,
            loadMsg:'正在加载...'
        });
    });
    function doSearch() {
        $('#userdatatable').datagrid('reload',{
            queryDate:$('#queryDate').datebox('getValue'),
            user_no:$('#user_no').val()
        });
    }

    function doDelete() {

        // 获得选择行
        var rows = $('#userdatatable').datagrid('getChecked');
        if (rows.length == 0) {
            msgError('提示,请至少选择一条数据再进行操作');
            return false;
        }
        var ids = [];
        for (let i in rows){
            ids.push(rows[i]._id)
        }
            // 获取远程数
                $.ajax({
                    url: '{{projcfg.appurl}}/admin/api/common/uum/login_err/delete' + ids,
                    type: 'delete',
                    success: function (data) {
                        if (data.success) {
                            msgSuccess(data.msg);
                            doSearch()
                        }
                        else {
                            msgError(data.msg + ',错误代码:' + data.code);
                        }
                    }
                });
    }
</script>