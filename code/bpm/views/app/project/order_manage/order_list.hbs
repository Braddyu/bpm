<link rel="stylesheet" type="text/css" href="{{projcfg.appurl}}/static/order/css/order_detail.css">
<div id="processDiv" class="row">
    <div class="col-xs-12 col-md-12">
        <div class="widget">
            <div class="widget-body">
                <div id="processLayout" class="easyui-layout" data-options="fit:true" style="width:600px;height:666px;">

                        <div id="toolbar1" class="row tbRow">
                            <div class="col-xs-8 col-md-8">
                                <div class="btn-group" role="group" aria-label="...">
                                    <button type="button" class="btn btn-default" onclick="openPage('新增流程基本属性',null,doAddProcessBase)"><i class="fa fa-plus"></i>新增</button>

                                </div>
                            </div>
                            <div class="col-xs-4 col-md-4 text-right">
                                <form class="form-inline">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <input type="input" id="filterParam1" class="form-control" style="width:130px;" placeholder="输入标题查询"/>
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" onclick="doSearch(1)"><i class="fa fa-search"></i>查询</button>
                                            </span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <table id="orderTablelist">

                        </table>


                </div>
            </div>
        </div>
    </div>
</div>

<div id="orderDetail"  class="mydialog"  >
    <fieldset>
        <legend ><b>任务基本信息</b></legend>

        <table cellpadding="5" align="center" style="border-collapse:separate; border-spacing:0px 5px;">
            <tr>
                <td align="right" class="tdLabel">工单标题:</td>
                <td colspan="3"><input style="width: 678px" class="easyui-textbox"type="text"id="proc_inst_task_title" ></input></td>


            </tr>
            <tr>
                <td align="right" class="tdLabel">工单类型:</td>
                <td><input style="width: 280px" class="easyui-textbox"type="text" id="warn_type"
                           ></input></td>

                <td align="right" class="tdLabel">工作天数:</td>
                <td><input style="width: 280px"class="easyui-textbox" type="text" id="work_day"
                           ></input></td>
            </tr>
            <tr>
                <td align="right" class="tdLabel">开始时间:</td>
                <td><input style="width: 280px"class="easyui-textbox" type="text"
                           id="proc_inst_task_arrive_time" ></input></td>
                <td align="right" class="tdLabel">完成时间:</td>
                <td><input style="width: 280px" class="easyui-textbox"type="text"
                           id="proc_inst_task_end_time" ></input></td>
                <td colspan="2"></td>


            </tr>
            <tr>
                <td align="right" class="tdLabel">发起人角色:</td>
                <td><input style="width: 280px"class="easyui-textbox" type="text"
                           id="proc_task_start_user_role_names" ></input></td>

                <td align="right" class="tdLabel">发起人:</td>
                <td><input style="width: 280px" class="easyui-textbox"type="text"
                           id="proc_task_start_name" ></input></td>

            </tr>


            <tr>
                <td align="right" class="tdLabel">派单内容:</td>
                <td colspan="3"><input
                        style="width: 695px; height: 50px; resize: none;" cols="30"
                        id="remark" rows="4"  class="easyui-textbox" label="Description:" labelPosition="top" multiline="true"/>

				</td>
            </tr>
        </table>
    </fieldset>


    <form id="jobDetail" method="post" enctype="multipart/form-data">
        <fieldset id="handlerTable">

            <legend><b>节点处理</b></legend>

            <table cellpadding="5" align="center" style="border-collapse:separate; border-spacing:0px 5px;">
                <tr>
                    <td align="right" class="tdLabel">当前节点:</td>
                    <td colspan="3"><input style="width: 695px" type="text" class="easyui-textbox" name="proc_inst_task_name" id="proc_inst_task_name" ></input></td>



                </tr>
                <tr id="tr_4">
                    <td align="right" class="tdLabel">操作:</td>
                    <td align="right" class="tdLabel">
                        <div id="isHandleY" style="float: left;">
                            <input type="radio" name="isHandle" value="1" />通过
                        </div>
                        <div id="isHandleN" style="float: left;">
                            <input type="radio" name="isHandle" value="2"/>退回
                        </div>


                    </td>
                </tr>
                <tr id="tr_5">
                    <td align="right" class="tdLabel">下一节点处理人:</td>
                    <td colspan="3"><select class="easyui-combobox"
                                            id="nextJobHandler" name="nextJobHandler" style="width: 200px;">

                    </select> </td>


                </tr>


                <tr>
                    <td align="right" class="tdLabel">处理意见:</td>
                    <td colspan="2"><input name="memo" class="easyui-textbox" label="Description:" labelPosition="top" multiline="true" style="width: 700px; height: 54px; resize: none;"/>

                    </td>

                </tr>
                <tr>
                    <td align="right" class="tdLabel">附件上传:</td>
                    <td>  <input class="easyui-filebox"labelPosition="top" data-options="prompt:'选择文件...',buttonText:'选择'" style="width:250px"/>
                    </td>
                </tr>


            </table>
        </fieldset>

    </form>
</div>



<script type="text/javascript">


    $(document).ready(function () {
        loadOrderListDatagrid();

    });
    //时间格式化:new Date().Format("yyyy-MM-dd hh:mm:ss");
    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }
    function loadOrderListDatagrid(){
        // 加载工单基本属性列表
        $('#orderTablelist').datagrid({
            url:'{{projcfg.appurl}}/api/order_manage/order_list/list',
            method:'post',
            rownumbers:true,
            striped:true,
            fitColumns:true,
            border:false,
            fit:true,
            toolbar: '#toolbar1',
            singleSelect:true,
            selectOnCheck:true,
            checkOnSelect:true,
            columns:[[
                {"field":"_id",checkbox:true},
                {"field": "application_title","title":"工单标题","width":100},
                {"field": "proc_base_name","title":"所属流程","width":50},
                {"field": "proc_inst_id","title":"版本","width":20},
                {"field": "node_name","title":"当前处理节点","width":50},
                {"field": "application_status","title":"状态","width":50,
                    formatter:function(value,row,index){
                        if(value == '1'){
                            return "处理中";
                        }else if(value == '2'){
                            return "已归档";
                        }else{
                            return "未提交";
                        }
                    }
                },
                {"field": "application_create_user_name","title":"申请人","width":50},
                {"field": "start_date","title":"创建时间","width":80,
                    formatter:function(value,row,index){
                       return  new Date(value).Format("yyyy-MM-dd hh:mm:ss");
                    }}
            ]],
            onDblClickRow:function(rowIndex, rowData){
                $('#orderDetail').show();
                $('#orderDetail').mydialog({
                    title:"新增工单",
                    width: 900,
                    height: 500,
                    top:150,
                    modal: true,
                    myButtons:[
                        {
                            text:'保存',
                            btnCls:'btn btn-blue',
                            handler:function(){
                                callback(1);
                            }
                        },
                        {
                            text:'提交流程',
                            btnCls:'btn btn-blue',
                            handler:function(){
                                callback(2);
                            }
                        },
                        {
                            text:'关闭',
                            btnCls:'btn btn-danger',
                            handler:function(){
                                closeDialog();
                            }
                        }
                    ]
                });
               /* $('#orderDetail').dialog('open')*/
            },
            onLoadSuccess:function(json) {
                if(!json.success) {
                    msgError(json.msg + ',错误代码:' + json.code);
                }
            },
            onLoadError:function() {
                msgError('加载数据出现时发生错误,请稍候重试...');
            },
            pagination:true,
            loadMsg:'正在加载...'
        });
    }

</script>